<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุฅุฏุงุฑุฉ ุงูุนููุฏ ุงูุทุจูุฉ</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>

<div class="container">
    <div class="admin-panel">
        <div class="admin-header">
            <div><span style="font-weight: 800;">๐ ุจูุงุจุฉ ุงูุฅุฏุงุฑุฉ</span> <span id="roleDisplay" style="color: #f1c40f; margin-right:10px;"></span></div>
            <button class="btn-primary" onclick="window.print()">๐จ ุทุจุงุนุฉ</button>
        </div>
        
        <div id="loginSection" style="text-align: center;">
            <button class="btn-primary" onclick="adminLogin()">๐ ุชุณุฌูู ุฏุฎูู</button>
        </div>

        <div id="adminControls" class="admin-controls">
            <button class="btn-purple super-admin-only" onclick="openModal('contractorModal')">๐ท ุฅุถุงูุฉ ููุงูู</button>
            <button class="btn-success super-admin-only" onclick="openModal('contractModal')">โ ุฅุถุงูุฉ ุนูุฏ ุฌุฏูุฏ</button>
            <button class="btn-primary super-admin-only" onclick="refreshMonthsSystem()">๐ ุชุญุฏูุซ ุงูุดููุฑ (ุงูุณูุฉ ุงูุญุงููุฉ)</button>
            <button class="btn-warning super-admin-only" onclick="systemReset()">โ ุชููุฆุฉ ุงููุธุงู</button>
            <button class="btn-danger" onclick="location.reload()">ุฎุฑูุฌ</button>
        </div>
    </div>

    <header>
        <div class="header-text">
            <h1>ูุธุงู ุฅุฏุงุฑุฉ ุนููุฏ ุงูุตูุงูุฉ ุงูุทุจูุฉ</h1>
            <h2>ูุชุงุจุนุฉ ุงููุณุชุฎูุตุงุช ุงูุดูุฑูุฉ</h2>
        </div>
        <div class="logo-container"><img src="TabukCluster.jpeg" alt="Logo"></div>
    </header>

    <div class="stats-grid">
        <div class="stat-card"><span class="stat-number" id="countHospitals">0</span><span class="stat-label">ุงูููุงูุน</span></div>
        <div class="stat-card"><span class="stat-number" id="countContracts">0</span><span class="stat-label">ุงูุนููุฏ</span></div>
        <div class="stat-card"><span class="stat-number" id="countLate" style="color:var(--danger)">0</span><span class="stat-label">ุงููุชุฃุฎุฑุงุช</span></div>
    </div>

    <div class="toolbar-section" style="display: flex; gap: 10px; margin-bottom: 20px;">
        <input type="text" id="searchBox" class="form-control" placeholder="ุจุญุซ ุดุงูู (ุงููุณุชุดูู / ุงูููุงูู)..." onkeyup="renderTable()">
        <select id="typeFilter" class="form-control" style="width: auto;" onchange="renderTable()">
            <option value="all">ุงููู</option>
            <option value="ุทุจู">ุนููุฏ ุทุจูุฉ</option>
            <option value="ุบูุฑ ุทุจู">ุนููุฏ ุบูุฑ ุทุจูุฉ</option>
        </select>
    </div>

    <div id="loader" style="text-align: center; color: var(--primary);">ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช...</div>
    <div id="toast">ุชู ุงูุญูุธ</div>

    <div class="table-wrapper">
        <table id="mainTable" style="display:none;">
            <thead><tr id="headerRow"></tr></thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <footer>ุชู ุงูุชุทููุฑ ุจูุงุณุทุฉ: ูุณู ุงูุตูุงูุฉ ุงูุทุจูุฉ ุจุชุฌูุน ุชุจูู ุงูุตุญู</footer>
</div>

<div id="contractModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ุฅุถุงูุฉ ุนูุฏ ุฌุฏูุฏ</h3>
            <button class="close-btn" onclick="closeModal('contractModal')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>ุงุณู ุงููููุน / ุงููุณุชุดูู <span style="color:red">*</span></label>
                <input type="text" id="form-hospital" class="form-control" placeholder="ูุซุงู: ูุณุชุดูู ุงูููู ููุฏ">
            </div>
            
            <div style="display: flex; gap: 10px;">
                <div class="form-group" style="flex:1">
                    <label>ููุน ุงูุนูุฏ <span style="color:red">*</span></label>
                    <select id="form-type" class="form-control">
                        <option value="ุทุจู">ุนูุฏ ุตูุงูุฉ ุทุจูุฉ</option>
                        <option value="ุบูุฑ ุทุจู">ุนูุฏ ุตูุงูุฉ ุบูุฑ ุทุจูุฉ</option>
                    </select>
                </div>
                <div class="form-group" style="flex:1">
                    <label>ุงูููุงูู <span style="color:red">*</span></label>
                    <select id="form-contractor" class="form-control">
                        <option value="">ุงุฎุชุฑ ุงูููุงูู...</option>
                    </select>
                </div>
            </div>

            <div style="display: flex; gap: 10px;">
                <div class="form-group" style="flex:1">
                    <label>ุจุฏุงูุฉ ุงูุนูุฏ</label>
                    <input type="date" id="form-start-date" class="form-control">
                </div>
                <div class="form-group" style="flex:1">
                    <label>ููุงูุฉ ุงูุนูุฏ</label>
                    <input type="date" id="form-end-date" class="form-control">
                </div>
            </div>

            <div class="form-group">
                <label>ูููุฉ ุงูุนูุฏ (ุฑูุงู)</label>
                <input type="number" id="form-value" class="form-control" placeholder="ูุซุงู: 500000">
            </div>

            <div class="form-group">
                <label>ุฑูู ุงูุนูุฏ ุงููุฑุฌุนู (ุงุฎุชูุงุฑู)</label>
                <input type="text" id="form-contract-num" class="form-control" placeholder="ุฑูู ุงูุนูุฏ ุงููุฑุฌุนู">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-success" onclick="saveNewContract()">ุญูุธ ุงูุนูุฏ</button>
            <button class="btn-dark" onclick="closeModal('contractModal')">ุฅูุบุงุก</button>
        </div>
    </div>
</div>

<div id="contractorModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ุฅุฏุงุฑุฉ ุงูููุงูููู</h3>
            <button class="close-btn" onclick="closeModal('contractorModal')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>ุฅุถุงูุฉ ููุงูู ุฌุฏูุฏ</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="form-new-contractor" class="form-control" placeholder="ุงุณู ุงูุดุฑูุฉ...">
                    <button class="btn-purple" onclick="saveNewContractor()">ุฅุถุงูุฉ</button>
                </div>
            </div>
            <hr>
            <label>ูุงุฆูุฉ ุงูููุงูููู ุงูุญุงูููู:</label>
            <div id="contractorsList" style="max-height: 200px; overflow-y: auto; border: 1px solid #eee; padding: 10px; border-radius: 5px;">
                </div>
        </div>
    </div>
</div>

<script type="module" src="js/app.js"></script>
</body>
</html>
