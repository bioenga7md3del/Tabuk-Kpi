<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุฅุฏุงุฑุฉ ุนููุฏ ุงูุตูุงูุฉ</title>
    <link rel="icon" href="TabukCluster.jpeg" type="image/jpeg">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>

<nav class="navbar">
    <div class="nav-brand">
        <img src="TabukCluster.jpeg" alt="Logo">
        <span style="margin-right:10px;">ุฅุฏุงุฑุฉ ุนููุฏ ุงูุตูุงูุฉ</span>
    </div>
    <div class="nav-links">
        <div class="nav-item active" onclick="window.switchView('dashboard-view')">๐ ุงูุฑุฆูุณูุฉ</div>
        <div class="nav-item restricted-tab" onclick="window.switchView('contracts-view')">๐ ุณุฌู ุงูุนููุฏ</div>
        <div class="nav-item restricted-tab" onclick="window.switchView('contractors-view')">๐ท ุณุฌู ุงูููุงูููู</div>
    </div>
    <div style="display:flex; gap:10px; align-items:center;">
        <span id="roleDisplay" style="color:var(--primary); font-weight:bold; font-size:12px;"></span>
        <button class="btn-primary" id="loginBtn" onclick="window.adminLogin()">๐ ุฏุฎูู</button>
        <button class="btn-danger hidden" id="logoutBtn" onclick="location.reload()">ุฎุฑูุฌ</button>
    </div>
</nav>

<div class="main-content">

    <section id="dashboard-view" class="page-section active">
        <div class="admin-panel hidden" id="dashboardControls">
            <div style="font-weight:bold; color:var(--secondary)">ุฃุฏูุงุช:</div>
            <div style="display:flex; gap:5px; flex-wrap:wrap;">
                <button class="btn-primary super-admin-only" onclick="window.refreshMonthsSystem()">๐ ุชุญุฏูุซ ุงูุดููุฑ</button>
                <button class="btn-warning super-admin-only" onclick="window.systemReset()">โ ุชููุฆุฉ</button>
                <button class="btn-purple super-admin-only" onclick="window.changePasswords()">๐ ุงูุจุงุณูุฑุฏ</button>
                <div style="width:1px; background:#ddd; margin:0 5px;"></div>
                <button class="btn-success" onclick="window.exportToExcel()">๐ Excel</button>
                <button class="btn-primary" onclick="window.print()">๐จ ุทุจุงุนุฉ</button>
            </div>
        </div>

        <div id="loginSection" style="text-align:center; margin:20px 0; color:#777;">ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู ููุชุญูู</div>

        <div class="stats-grid">
            <div class="stat-card"><span class="stat-number" id="countContracts">0</span><span class="stat-label">ุงูุนููุฏ</span></div>
            <div class="stat-card"><span class="stat-number" id="countActive" style="color:var(--success)">0</span><span class="stat-label">ุณุงุฑู</span></div>
            <div class="stat-card"><span class="stat-number" id="countExpired" style="color:var(--danger)">0</span><span class="stat-label">ููุชูู</span></div>
            <div class="stat-card"><span class="stat-number" id="countLate" style="color:var(--danger)">0</span><span class="stat-label">ูุชุฃุฎุฑุงุช</span></div>
            <div class="stat-card" style="border-right-color:var(--success)"><span class="stat-number" id="complianceRate" style="color:var(--success)">0%</span><span class="stat-label">ุงูุงูุชุฒุงู</span></div>
        </div>

        <div id="yearTabs" class="year-tabs-container" style="display:none;"></div>

        <div class="toolbar-section">
            <div style="flex:1; min-width:200px;"><input type="text" id="searchHospital" class="form-control" placeholder="ุจุญุซ ุจุงุณู ุงูุนูุฏ..." onkeyup="window.renderTable()"></div>
            <div style="flex:1; min-width:200px;"><input type="text" id="searchContractor" class="form-control" placeholder="ุจุญุซ ุจุงูููุงูู..." onkeyup="window.renderTable()"></div>
            <div style="flex:1; min-width:150px;"><input type="text" id="searchClaim" class="form-control" placeholder="ุฑูู ุงููุทุงูุจุฉ..." onkeyup="window.renderTable()"></div>
            <select id="typeFilter" class="form-control" style="width:auto; min-width:150px;" onchange="window.renderTable()">
                <option value="all">ุงููู</option>
                <option value="ุทุจู">ุทุจู</option>
                <option value="ุบูุฑ ุทุจู">ุบูุฑ ุทุจู</option>
            </select>
        </div>

        <div class="table-wrapper">
            <table id="mainTable" style="display:none;">
                <thead><tr id="headerRow"></tr></thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </section>

    <section id="contracts-view" class="page-section">
        <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); margin-bottom: 20px;">
            <div class="stat-card" style="border-right-color: var(--success);"><span class="stat-number" id="cardActiveContracts">0</span><span class="stat-label">ุนููุฏ ุณุงุฑูุฉ</span></div>
            <div class="stat-card" style="border-right-color: #f1c40f;"><span class="stat-number" id="cardSoonContracts">0</span><span class="stat-label">ุนูู ูุดู ุงูุงูุชูุงุก</span></div>
            <div class="stat-card" style="border-right-color: var(--danger);"><span class="stat-number" id="cardExpiredContracts">0</span><span class="stat-label">ุนููุฏ ููุชููุฉ</span></div>
            <div class="stat-card" style="border-right-color: var(--primary);"><span class="stat-number" id="cardTotalMedical" style="font-size: 18px;">0</span><span class="stat-label">ูููุฉ ุงูุนููุฏ ุงูุทุจูุฉ</span></div>
            <div class="stat-card" style="border-right-color: #d35400;"><span class="stat-number" id="cardTotalNonMedical" style="font-size: 18px;">0</span><span class="stat-label">ูููุฉ ุงูุนููุฏ ุบูุฑ ุงูุทุจูุฉ</span></div>
        </div>

        <div class="admin-panel">
            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap; flex: 1;">
                <h2 style="margin:0; font-size:18px; min-width: 100px;">ุณุฌู ุงูุนููุฏ</h2>
                <input id="filterContractName" class="form-control" style="max-width: 200px;" placeholder="ุจุญุซ..." onkeyup="window.renderContractsCards()">
                <select id="filterContractStatus" class="form-control" style="width: auto;" onchange="window.renderContractsCards()">
                    <option value="all">ูู ุงูุญุงูุงุช</option>
                    <option value="active">ุณุงุฑู โ</option>
                    <option value="soon">ุนูู ูุดู ุงูุงูุชูุงุก โ๏ธ</option>
                    <option value="expired">ููุชูู โ</option>
                </select>
                <select id="filterContractType2" class="form-control" style="width: auto;" onchange="window.renderContractsCards()">
                    <option value="all">ูู ุงูุฃููุงุน</option>
                    <option value="ุทุจู">ุทุจู</option>
                    <option value="ุบูุฑ ุทุจู">ุบูุฑ ุทุจู</option>
                </select>
            </div>
            <div style="display: flex; gap: 5px;">
                <button class="btn-primary" onclick="window.print()">๐จ ุทุจุงุนุฉ ุงููุงุฆูุฉ</button>
                <button class="btn-success" onclick="window.openModal('contractModal')">โ ุฅุถุงูุฉ ุนูุฏ</button>
            </div>
        </div>
        <div id="contractsGrid" class="cards-grid"></div>
    </section>

    <section id="contractors-view" class="page-section">
        <div class="admin-panel">
            <h2 style="margin:0; font-size:18px;">ุณุฌู ุงูููุงูููู</h2>
            <button class="btn-purple" onclick="window.openModal('contractorModal')">โ ุฅุถุงูุฉ ููุงูู</button>
        </div>
        <div id="contractorsGrid" class="cards-grid"></div>
    </section>

</div>

<div id="loader" style="position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:white; padding:20px; box-shadow:0 0 10px rgba(0,0,0,0.2); border-radius:10px; z-index:5000;">ุฌุงุฑู ุงูุชุญููู...</div>
<div id="toast">ุชู ุงูุญูุธ</div>

<div id="contractModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header"><h3>ุจูุงูุงุช ุงูุนูุฏ</h3><button class="close-btn" onclick="window.closeModal('contractModal')">&times;</button></div>
        <div class="modal-body">
            <input type="hidden" id="form-contract-id">
            <div class="form-group"><label>ุงุณู ุงูุนูุฏ / ุงููููุน <span style="color:red">*</span></label><input type="text" id="form-contract-name" class="form-control" placeholder="ูุซุงู: ุนูุฏ ุตูุงูุฉ ูุณุชุดูู..."></div>
            <div style="display:flex; gap:10px;">
                <div class="form-group" style="flex:1"><label>ุงูููุน</label><select id="form-type" class="form-control"><option value="ุทุจู">ุทุจู</option><option value="ุบูุฑ ุทุจู">ุบูุฑ ุทุจู</option></select></div>
                <div class="form-group" style="flex:1"><label>ุงูููุงูู</label><select id="form-contractor" class="form-control"></select></div>
            </div>
            <div style="display:flex; gap:10px;">
                <div class="form-group" style="flex:1"><label>ุจุฏุงูุฉ ุงูุนูุฏ</label><input type="date" id="form-start-date" class="form-control"></div>
                <div class="form-group" style="flex:1"><label>ููุงูุฉ ุงูุนูุฏ</label><input type="date" id="form-end-date" class="form-control"></div>
            </div>
            <div style="display:flex; gap:10px;">
                <div class="form-group" style="flex:1"><label>ุงููุฏุฉ</label><input type="text" id="form-duration" class="form-control" placeholder="ูุซุงู: 3 ุณููุงุช"></div>
                <div class="form-group" style="flex:1"><label>ุงููููุฉ</label><input type="number" id="form-value" class="form-control"></div>
            </div>
            <div class="form-group"><label>ุฑูู ุงูุนูุฏ</label><input type="text" id="form-contract-num" class="form-control"></div>
        </div>
        <div class="modal-footer"><button class="btn-primary" onclick="window.saveContract()">ุญูุธ</button><button class="btn-danger" onclick="window.closeModal('contractModal')">ุฅูุบุงุก</button></div>
    </div>
</div>

<div id="contractorModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header"><h3>ุจูุงูุงุช ุงูููุงูู</h3><button class="close-btn" onclick="window.closeModal('contractorModal')">&times;</button></div>
        <div class="modal-body">
            <input type="hidden" id="form-contractor-id">
            <div class="form-group"><label>ุงุณู ุงูุดุฑูุฉ <span style="color:red">*</span></label><input type="text" id="form-new-contractor" class="form-control"></div>
        </div>
        <div class="modal-footer"><button class="btn-primary" onclick="window.saveContractor()">ุญูุธ</button><button class="btn-danger" onclick="window.closeModal('contractorModal')">ุฅูุบุงุก</button></div>
    </div>
</div>

<script type="module" src="js/app.js"></script>
</body>
</html>
